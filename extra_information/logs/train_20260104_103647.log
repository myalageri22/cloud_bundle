2026-01-04 10:36:47 VascularSeg INFO Logging initialized. Log file: /Users/prade/U-NET-ISEF/cloud_bundle/logs/train_20260104_103647.log
2026-01-04 10:36:47 VascularSeg INFO Device selected: mps
2026-01-04 10:36:47 VascularSeg INFO CUDA available: False
2026-01-04 10:36:47 VascularSeg INFO MPS built: True, MPS available: True
2026-01-04 10:36:47 VascularSeg INFO ✅ Using Apple GPU via MPS.
2026-01-04 10:36:47 VascularSeg INFO Starting vascular segmentation training pipeline
2026-01-04 10:36:47 VascularSeg INFO Experiment: 20260104_103647
2026-01-04 10:36:47 VascularSeg INFO Device: mps
2026-01-04 10:36:47 VascularSeg INFO Dataset preset=custom dataset=custom
2026-01-04 10:36:47 VascularSeg INFO PyTorch version: 2.8.0
2026-01-04 10:36:47 VascularSeg INFO CUDA available: False
2026-01-04 10:36:47 VascularSeg INFO MPS status - built: True, available: True
2026-01-04 10:36:47 VascularSeg INFO Model compilation (torch.compile): True
2026-01-04 10:36:47 VascularSeg INFO DataLoader workers: 8 (prefetch=2, persistent=True)
2026-01-04 10:36:47 VascularSeg INFO 
2026-01-04 10:36:47 VascularSeg INFO 1. dataset discovery
2026-01-04 10:36:47 VascularSeg INFO Scanning dataset under /Users/prade/U-NET-ISEF/cloud_bundle
2026-01-04 10:36:48 VascularSeg INFO Total samples found: 1000
2026-01-04 10:36:48 VascularSeg INFO   id=1 image=/Users/prade/U-NET-ISEF/cloud_bundle/data/processed/all/1-200/1.img.nii.gz label=/Users/prade/U-NET-ISEF/cloud_bundle/data/processed/all/1-200/1.label.nii.gz
2026-01-04 10:36:48 VascularSeg INFO   id=2 image=/Users/prade/U-NET-ISEF/cloud_bundle/data/processed/all/1-200/2.img.nii.gz label=/Users/prade/U-NET-ISEF/cloud_bundle/data/processed/all/1-200/2.label.nii.gz
2026-01-04 10:36:48 VascularSeg INFO   id=3 image=/Users/prade/U-NET-ISEF/cloud_bundle/data/processed/all/1-200/3.img.nii.gz label=/Users/prade/U-NET-ISEF/cloud_bundle/data/processed/all/1-200/3.label.nii.gz
2026-01-04 10:36:48 VascularSeg INFO Sanity sample id=1 -> image shape (512, 512, 275) (min -1024.0000 max 3071.0000), label shape (512, 512, 275) (min 0.0000 max 1.0000)
2026-01-04 10:36:48 VascularSeg INFO 
2026-01-04 10:36:48 VascularSeg INFO 2. dataset split
2026-01-04 10:36:48 VascularSeg INFO Using existing split from /Users/prade/U-NET-ISEF/cloud_bundle/splits.json (train=700, val=50, test=250)
2026-01-04 10:36:48 VascularSeg INFO 
2026-01-04 10:36:48 VascularSeg INFO 3. building data loaders
2026-01-04 10:36:49 VascularSeg INFO Creating training dataset (cache_rate=0.25)...
2026-01-04 10:39:00 VascularSeg INFO Training dataset ready in 130.6s
2026-01-04 10:39:00 VascularSeg INFO Creating validation dataset (cache_rate=1.00)...
2026-01-04 10:39:35 VascularSeg INFO Validation dataset ready in 34.8s
2026-01-04 10:39:35 VascularSeg INFO   Train batches: 350
2026-01-04 10:39:35 VascularSeg INFO   Val batches: 50
2026-01-04 10:39:35 VascularSeg INFO 
2026-01-04 10:39:35 VascularSeg INFO 4. model initialization
2026-01-04 10:39:35 VascularSeg INFO ✅ Using MONAI AttentionUnet
2026-01-04 10:39:35 VascularSeg WARNING MPS compilation unstable; skipping
2026-01-04 10:39:35 VascularSeg INFO Model parameters:
2026-01-04 10:39:35 VascularSeg INFO   Total: 23,625,953
2026-01-04 10:39:35 VascularSeg INFO   Trainable: 23,625,953
2026-01-04 10:39:35 VascularSeg INFO   Size: ~90.1 MB (FP32)
2026-01-04 10:39:35 VascularSeg INFO 
2026-01-04 10:39:35 VascularSeg INFO 5. loss function and metrics
2026-01-04 10:39:35 VascularSeg INFO Computing class weights from training data...
2026-01-04 10:43:34 VascularSeg INFO   Positive voxels: 78,936,341
2026-01-04 10:43:34 VascularSeg INFO   Negative voxels: 47,202,404,075
2026-01-04 10:43:34 VascularSeg INFO   Ratio (neg/pos): 200.00
2026-01-04 10:43:34 VascularSeg INFO   pos_weight = 200.00
2026-01-04 10:43:34 VascularSeg INFO Loss: 40% Dice + 40% Focal + 20% Tversky
2026-01-04 10:43:34 VascularSeg INFO Metrics: Dice Score, Hausdorff Distance (95th percentile)
2026-01-04 10:43:34 VascularSeg INFO 
2026-01-04 10:43:34 VascularSeg INFO 6. optimizer and scheduler
2026-01-04 10:43:34 VascularSeg INFO Scheduler: Warmup (875 steps) + CosineAnnealing
2026-01-04 10:43:34 VascularSeg INFO 
2026-01-04 10:43:34 VascularSeg INFO 7. training loop
2026-01-04 10:43:34 VascularSeg INFO No checkpoint resume requested; starting from scratch.
2026-01-04 10:44:00 VascularSeg INFO [DEVICE] images device=mps:0, labels device=mps:0
